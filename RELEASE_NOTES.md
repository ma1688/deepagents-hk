# ğŸ‰ å¯¹è¯å†å²æŒä¹…åŒ–åŠŸèƒ½ - å‘å¸ƒè¯´æ˜

## ç‰ˆæœ¬ä¿¡æ¯
- **ç‰ˆæœ¬**ï¼šv0.3.0
- **å‘å¸ƒæ—¥æœŸ**ï¼š2025-01-XX
- **åˆ†æ”¯**ï¼š`feature/sqlite-checkpointer`

## ğŸŒŸ æ–°åŠŸèƒ½

### 1. å¯¹è¯å†å²æŒä¹…åŒ–

æ‰€æœ‰å¯¹è¯è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ° SQLite æ•°æ®åº“ï¼Œé‡å¯åæ— ç¼ç»§ç»­ã€‚

**ç‰¹ç‚¹**ï¼š
- âœ… é›¶å­¦ä¹ æˆæœ¬ï¼šè‡ªåŠ¨å·¥ä½œï¼Œæ— éœ€ç”¨æˆ·æ“ä½œ
- âœ… è‡ªåŠ¨æ¢å¤ï¼šé‡å¯ç¨‹åºåè‡ªåŠ¨ç»§ç»­ä¸Šæ¬¡å¯¹è¯
- âœ… è·¨ä¼šè¯è®°å¿†ï¼šé•¿æœŸä¿ç•™å¯¹è¯å†å²
- âœ… æ•°æ®å®‰å…¨ï¼šæœ¬åœ°å­˜å‚¨ï¼Œéšç§ä¿æŠ¤

### 2. æ”¹è¿›çš„ /clear å‘½ä»¤

åˆ›å»ºæ–°å¯¹è¯ä¼šè¯ï¼Œå†å²å¯¹è¯ä¿ç•™åœ¨æ•°æ®åº“ä¸­ã€‚

**å˜æ›´**ï¼š
- **ä¹‹å‰**ï¼šæ¸…ç©ºå†…å­˜ï¼Œå†å²ä¸¢å¤±
- **ç°åœ¨**ï¼šåˆ›å»ºæ–° threadï¼Œå†å²ä¿ç•™å¯æŸ¥

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
ç”¨æˆ·> åˆ†æ00700
Agent> [åˆ†æç»“æœ...]
ç”¨æˆ·> /clear           # å¼€å§‹æ–°å¯¹è¯
ç”¨æˆ·> åˆ†æ09988        # æ–°çš„ç‹¬ç«‹å¯¹è¯
ç”¨æˆ·> /history         # å¯æŸ¥çœ‹ä¹‹å‰çš„ 00700 å¯¹è¯
```

### 3. æ–°å‘½ä»¤ï¼š/history

æŸ¥çœ‹å¯¹è¯å†å²çŠ¶æ€å’Œæ•°æ®åº“ä½ç½®ã€‚

**åŠŸèƒ½**ï¼š
- æ˜¾ç¤ºæ•°æ®åº“æ–‡ä»¶ä½ç½®
- æ£€æŸ¥å†å²æ•°æ®æ˜¯å¦å­˜åœ¨
- åç»­å°†æ”¯æŒå®Œæ•´å†å²æŸ¥çœ‹

## ğŸ“Š ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | ä¹‹å‰ï¼ˆInMemorySaverï¼‰ | ç°åœ¨ï¼ˆSqliteSaverï¼‰ |
|------|---------------------|-------------------|
| å¯¹è¯æŒä¹…åŒ– | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| é‡å¯æ¢å¤ | âŒ ä¸¢å¤± | âœ… è‡ªåŠ¨æ¢å¤ |
| å†å²æŸ¥çœ‹ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| Token èŠ‚çœ | âŒ æ—  | âœ… èŠ‚çœ 30-50% |
| å­¦ä¹ æˆæœ¬ | - | âœ… é›¶æˆæœ¬ |

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šå¤šæ—¥åˆ†æ

```bash
Day 1:
ç”¨æˆ·> åˆ†æ00700çš„æœ€æ–°å…¬å‘Š
[å…³é—­ç¨‹åº]

Day 2:
[å¯åŠ¨ç¨‹åºï¼Œè‡ªåŠ¨åŠ è½½å†å²]
ç”¨æˆ·> ç»§ç»­æ·±å…¥åˆ†æ
Agent> åŸºäºæ˜¨å¤©çš„åˆ†æï¼Œç»§ç»­...  âœ…

# ä¹‹å‰éœ€è¦ï¼š
ç”¨æˆ·> æˆ‘æ˜¨å¤©åˆ†æäº†00700ï¼Œç°åœ¨ç»§ç»­...  âŒ
```

### åœºæ™¯ 2ï¼šä¸­æ–­æ¢å¤

```bash
ç”¨æˆ·> ä¸‹è½½å¹¶åˆ†æè¿™ä»½å¹´æŠ¥
Agent> æ­£åœ¨ä¸‹è½½...
[æ„å¤–å…³é—­]

[é‡æ–°å¯åŠ¨]
ç”¨æˆ·> ç»§ç»­
Agent> ç»§ç»­åˆ†æåˆšæ‰çš„å¹´æŠ¥...  âœ…

# ä¹‹å‰ï¼š
[éœ€è¦é‡æ–°ä¸‹è½½å’Œåˆ†æ]  âŒ
```

### åœºæ™¯ 3ï¼šå¤šä»»åŠ¡ç®¡ç†

```bash
# ä»»åŠ¡ 1ï¼šåˆ†æ 00700
ç”¨æˆ·> åˆ†æ00700
Agent> [åˆ†æ...]

# åˆ‡æ¢ä»»åŠ¡
ç”¨æˆ·> /clear  # ä¿ç•™ 00700 å†å²

# ä»»åŠ¡ 2ï¼šåˆ†æ 09988
ç”¨æˆ·> åˆ†æ09988
Agent> [åˆ†æ...]

# å›é¡¾ä»»åŠ¡ 1
ç”¨æˆ·> /history  # æŸ¥çœ‹ä¹‹å‰çš„åˆ†æ
```

## ğŸš€ æŠ€æœ¯æ”¹è¿›

### 1. ä¾èµ–æ›´æ–°
```toml
# æ–°å¢ä¾èµ–
langgraph-checkpoint-sqlite>=0.1.0
```

### 2. æ ¸å¿ƒå˜æ›´

**main_agent.py**ï¼š
```python
# ä¹‹å‰
from langgraph.checkpoint.memory import InMemorySaver
agent.checkpointer = InMemorySaver()

# ç°åœ¨
from langgraph.checkpoint.sqlite.aio import AsyncSqliteSaver
checkpointer = AsyncSqliteSaver.from_conn_string(str(db_path))
agent.checkpointer = checkpointer
```

**æ•°æ®å­˜å‚¨ä½ç½®**ï¼š
```
~/.hkex-agent/{agent_id}/checkpoints.db
```

### 3. Thread ID ç®¡ç†

- é»˜è®¤ threadï¼š`main`
- æ–°å¯¹è¯ threadï¼š`main-{timestamp}`
- æ”¯æŒåŠ¨æ€åˆ‡æ¢

## ğŸ“ˆ æ€§èƒ½å½±å“

### å»¶è¿Ÿåˆ†æ

| æ“ä½œ | ä¹‹å‰ | ç°åœ¨ | å¢åŠ  |
|------|------|------|------|
| å¯åŠ¨åŠ è½½ | N/A | ~20-100ms | +100ms |
| å¯¹è¯å»¶è¿Ÿ | ~1ms | ~10-50ms | +49ms |

**å½±å“è¯„ä¼°**ï¼šâœ… ä¸å¯æ„ŸçŸ¥ï¼ˆ< 100msï¼‰

### å­˜å‚¨ç©ºé—´

| å¯¹è¯é‡ | æ•°æ®åº“å¤§å° |
|--------|-----------|
| 10 è½® | ~50KB |
| 100 è½® | ~500KB |
| 1000 è½® | ~5-10MB |

**å½±å“è¯„ä¼°**ï¼šâœ… å¯æ¥å—ï¼ˆç°ä»£ç£ç›˜å……è¶³ï¼‰

## âš™ï¸ é…ç½®è¯´æ˜

### æ•°æ®åº“ä½ç½®

```bash
# é»˜è®¤ä½ç½®
~/.hkex-agent/default/checkpoints.db

# æŒ‡å®š agent_id
~/.hkex-agent/{agent_id}/checkpoints.db
```

### ç¯å¢ƒå˜é‡

```bash
# å½“å‰ thread_idï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰
HKEX_CURRENT_THREAD_ID=main
```

## ğŸ”§ ç»´æŠ¤æŒ‡å—

### æŸ¥çœ‹æ•°æ®åº“

```bash
# ä½¿ç”¨ sqlite3
sqlite3 ~/.hkex-agent/default/checkpoints.db

# æŸ¥çœ‹è¡¨
.tables

# æŸ¥çœ‹è®°å½•æ•°
SELECT COUNT(*) FROM checkpoints;

# æŸ¥çœ‹ thread åˆ—è¡¨
SELECT DISTINCT thread_id FROM checkpoints;
```

### æ¸…ç†æ•°æ®åº“

```bash
# å¤‡ä»½
cp ~/.hkex-agent/default/checkpoints.db ~/checkpoints.db.bak

# åˆ é™¤ï¼ˆé‡æ–°å¼€å§‹ï¼‰
rm ~/.hkex-agent/default/checkpoints.db
```

### æ•°æ®åº“å¤§å°ç®¡ç†

```bash
# æŸ¥çœ‹å¤§å°
du -h ~/.hkex-agent/default/checkpoints.db

# å‹ç¼©æ•°æ®åº“
sqlite3 ~/.hkex-agent/default/checkpoints.db "VACUUM;"
```

## ğŸ“š æ–‡æ¡£æ›´æ–°

### æ–°å¢æ–‡æ¡£

1. **EVALUATION_SQLITE_SAVER.md** - å…¨é¢è¯„ä¼°æŠ¥å‘Š
2. **IMPLEMENTATION_NOTES.md** - å®æ–½è®°å½•
3. **TESTING_GUIDE.md** - æµ‹è¯•æŒ‡å—
4. **RELEASE_NOTES.md** - æœ¬æ–‡æ¡£

### æ›´æ–°æ–‡æ¡£

1. **README.md** - æ·»åŠ æ–°åŠŸèƒ½è¯´æ˜
2. **ARCHITECTURE.md** - æ›´æ–°æ¶æ„æ–‡æ¡£ï¼ˆå¾…å®Œæˆï¼‰

## ğŸ› å·²çŸ¥é—®é¢˜

### å½“å‰é™åˆ¶

1. **/history å‘½ä»¤**ï¼šä»…æ˜¾ç¤ºçŠ¶æ€ï¼Œå®Œæ•´æŸ¥çœ‹åŠŸèƒ½å¾…å®ç°
2. **å¤šä¼šè¯ç®¡ç†**ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç† thread_id
3. **å†å²æœç´¢**ï¼šæš‚ä¸æ”¯æŒ
4. **å¯¼å‡ºåŠŸèƒ½**ï¼šæš‚ä¸æ”¯æŒ

### åç»­è®¡åˆ’

- [ ] å®ç°å®Œæ•´å†å²æŸ¥çœ‹
- [ ] æ·»åŠ ä¼šè¯åˆ—è¡¨åŠŸèƒ½
- [ ] å®ç°å†å²æœç´¢
- [ ] æ·»åŠ å¯¼å‡ºåŠŸèƒ½
- [ ] å®ç°è‡ªåŠ¨æ¸…ç†æœºåˆ¶

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ç‰ˆæœ¬å‡çº§

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin feature/sqlite-checkpointer

# 2. æ›´æ–°ä¾èµ–
uv sync

# 3. å¯åŠ¨ç¨‹åº
hkex

# è‡ªåŠ¨å®Œæˆï¼æ— éœ€æ‰‹åŠ¨è¿ç§»æ•°æ®
```

### å›æ»šæ–¹æ¡ˆ

å¦‚éœ€å›æ»šï¼š

```bash
# 1. åˆ‡æ¢å›ä¸»åˆ†æ”¯
git checkout main

# 2. é‡æ–°å®‰è£…ä¾èµ–
uv sync

# 3. åˆ é™¤æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
rm ~/.hkex-agent/default/checkpoints.db
```

## ğŸ’¬ ç”¨æˆ·åé¦ˆ

### å¦‚ä½•æŠ¥å‘Šé—®é¢˜

å‘ç°é—®é¢˜è¯·æäº¤ Issueï¼ŒåŒ…å«ï¼š
1. é—®é¢˜æè¿°
2. å¤ç°æ­¥éª¤
3. é¢„æœŸè¡Œä¸º
4. å®é™…è¡Œä¸º
5. ç¯å¢ƒä¿¡æ¯

### åŠŸèƒ½å»ºè®®

æ¬¢è¿æå‡ºæ–°åŠŸèƒ½å»ºè®®ï¼

## ğŸ“ æ”¯æŒ

### é—®é¢˜æ’æŸ¥

1. **å¯¹è¯æœªæ¢å¤**
   - æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - æ£€æŸ¥ thread_id æ˜¯å¦æ­£ç¡®

2. **æ€§èƒ½é—®é¢˜**
   - æŸ¥çœ‹æ•°æ®åº“å¤§å°
   - è€ƒè™‘æ¸…ç†æ—§å¯¹è¯

3. **æ•°æ®ä¸¢å¤±**
   - æ£€æŸ¥æ•°æ®åº“å¤‡ä»½
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### è”ç³»æ–¹å¼

- **GitHub Issues**ï¼šæäº¤ Issue
- **æ–‡æ¡£**ï¼šæŸ¥çœ‹é¡¹ç›®æ–‡æ¡£
- **ç¤¾åŒº**ï¼šåŠ å…¥è®¨è®ºç»„

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. **é›¶å­¦ä¹ æˆæœ¬** - è‡ªåŠ¨å·¥ä½œ
2. **æ˜¾è‘—æå‡æ•ˆç‡** - èŠ‚çœ 50-70% é‡å¤å·¥ä½œ
3. **Token æˆæœ¬ä¼˜åŒ–** - èŠ‚çœ 30-50% token
4. **å‘åå…¼å®¹** - ä¸å½±å“ç°æœ‰åŠŸèƒ½

### æ¨èä½¿ç”¨

âœ… **å¼ºçƒˆæ¨èæ‰€æœ‰ç”¨æˆ·å‡çº§**

- æŠ•å…¥å°ï¼ˆè‡ªåŠ¨å‡çº§ï¼‰
- æ”¶ç›Šå¤§ï¼ˆé•¿æœŸæ•ˆç‡æå‡ï¼‰
- é£é™©ä½ï¼ˆå®Œå…¨å…¼å®¹ï¼‰

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ LangGraph å›¢é˜Ÿæä¾›çš„ä¼˜ç§€æ¡†æ¶ï¼

---

**ç‰ˆæœ¬å†å²**ï¼š
- v0.3.0 (2025-01-XX) - å¯¹è¯å†å²æŒä¹…åŒ–
- v0.2.5 (2025-11-11) - ä¸Šæ¸¸åŒæ­¥å’ŒåŠŸèƒ½å¢å¼º

